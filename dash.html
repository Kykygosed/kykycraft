<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Panel Admin</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f5f5f5;
      padding: 30px;
    }
    h1, h3 {
      color: #333;
    }
    input, textarea, button {
      display: block;
      margin: 10px 0;
      padding: 8px;
      width: 300px;
      max-width: 100%;
    }
    button {
      width: auto;
      background-color: #007bff;
      border: none;
      color: white;
      cursor: pointer;
      border-radius: 4px;
    }
    button:hover {
      background-color: #0056b3;
    }
    #questionsContainer input {
      width: 100%;
      margin-bottom: 5px;
    }
  </style>
</head>
<body>
  <h1>Panneau d'administration</h1>

  <div id="passwordSection">
    <h3>Entrer le mot de passe admin</h3>
    <input type="password" id="passwordInput" placeholder="Mot de passe">
    <button onclick="checkPassword()">Valider</button>
  </div>

  <div id="panelSection" style="display:none;">
    <label>Titre de l'évènement:</label>
    <input type="text" id="title">

    <label>Description de l'évènement:</label>
    <textarea id="description"></textarea>

    <label>Nombre max d'inscriptions:</label>
    <input type="number" id="max">

    <h3>Questions</h3>
    <div id="questionsContainer"></div>
    <button onclick="addQuestion()">Nouvelle question</button>

    <hr>
    <button onclick="saveAll()">Enregistrer</button>
    <button onclick="setShow()">Afficher</button>
    <button onclick="toggleState()" id="stateBtn">Démarrer les inscriptions</button>
  </div>

  <!-- Firebase & JS -->
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyDQGmbiwh5LTVq0Wp1q9NrSQzs86vER2XM",
      authDomain: "kychat-45596.firebaseapp.com",
      databaseURL: "https://kychat-45596-default-rtdb.firebaseio.com",
      projectId: "kychat-45596",
      storageBucket: "kychat-45596.firebasestorage.app",
      messagingSenderId: "104462848972",
      appId: "1:104462848972:web:7ac49e63008e9a11150369"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    let currentState = "closed";

    function checkPassword() {
      const input = document.getElementById("passwordInput").value;
      db.ref("password").once("value").then(snapshot => {
        if (snapshot.val() === input) {
          document.getElementById("passwordSection").style.display = "none";
          document.getElementById("panelSection").style.display = "block";
        } else {
          alert("Mot de passe incorrect.");
          window.location.href = "index.html";
        }
      });
    }

    function addQuestion() {
      const container = document.getElementById("questionsContainer");
      const input = document.createElement("input");
      input.type = "text";
      input.placeholder = "Entrez une question";
      input.className = "questionInput";
      container.appendChild(input);
    }

    function saveAll() {
      const title = document.getElementById("title").value.trim();
      const description = document.getElementById("description").value.trim();
      const max = parseInt(document.getElementById("max").value);
      const questions = Array.from(document.getElementsByClassName("questionInput"))
        .map(input => input.value.trim())
        .filter(q => q.length > 0);

      if (!title || !description || isNaN(max)) {
        alert("Merci de remplir tous les champs.");
        return;
      }

      db.ref("event").set({
        title,
        description,
        max
      });

      db.ref("questions").set(questions);

      alert("Évènement et questions enregistrés !");
    }

    function setShow() {
      db.ref("show").set(true);
      alert("Champ 'show' activé !");
    }

    function toggleState() {
      let nextState;
      if (currentState === "closed") {
        nextState = "open";
        document.getElementById("stateBtn").innerText = "Fermer les inscriptions";
      } else if (currentState === "open") {
        nextState = "nowclosed";
        document.getElementById("stateBtn").innerText = "Finir";
      } else if (currentState === "nowclosed") {
        nextState = "Closed";
        document.getElementById("stateBtn").innerText = "Inscriptions terminées";
        document.getElementById("stateBtn").disabled = true;
      }

      if (nextState) {
        db.ref("state").set(nextState);
        currentState = nextState;
        alert("État changé à  " + nextState);
      }
    }
  </script>
</body>
</html>
