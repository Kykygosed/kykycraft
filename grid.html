<!DOCTYPE html>
<html>
<head>
  <title>Grille Caméras</title>
  <style>
    body { margin: 0; background: #111; }
    .grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      grid-template-rows: repeat(2, 1fr);
      gap: 4px;
      height: 100vh;
    }
    .grid-item {
      position: relative;
      background: #222;
    }
    video {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }
    .no-data {
      color: red;
      font-size: 20px;
      text-align: center;
      padding-top: 40%;
    }
  </style>
</head>
<body>
  <div class="grid" id="cameraGrid"></div>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.12.2/firebase-database-compat.js"></script>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyBPq6Wfxzq02MfK69BFxHm9_FUjDGTmAcw",
      authDomain: "kykychat-24c7f.firebaseapp.com",
      databaseURL: "https://kykychat-24c7f-default-rtdb.firebaseio.com",
      projectId: "kykychat-24c7f",
      storageBucket: "kykychat-24c7f.appspot.com",
      messagingSenderId: "342562811927",
      appId: "1:342562811927:web:0fed1e1f511c4fddcfec52"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    const cameraGrid = document.getElementById('cameraGrid');

    function createCameraCell(name) {
      const div = document.createElement('div');
      div.className = 'grid-item';

      // Impossible d'accéder au stream WebRTC d'un autre client directement sans serveur
      // donc ici on montre juste "NO DATA" ou on pourrait imaginer une iframe ou WebRTC relayé
      const label = document.createElement('div');
      label.className = 'no-data';
      label.textContent = "NO DATA";
      div.appendChild(label);
      return div;
    }

    firebase.database().ref('cameras').on('value', snapshot => {
      const data = snapshot.val() || {};
      const entries = Object.entries(data);
      cameraGrid.innerHTML = '';

      for (let i = 0; i < 4; i++) {
        const [name] = entries[i] || [null];
        if (name) {
          const iframe = document.createElement('iframe');
          iframe.src = "broadcast.html?view=" + name;
          iframe.style.width = "100%";
          iframe.style.height = "100%";
          iframe.style.border = "none";

          const cell = document.createElement('div');
          cell.className = 'grid-item';
          cell.appendChild(iframe);
          cameraGrid.appendChild(cell);
        } else {
          cameraGrid.appendChild(createCameraCell());
        }
      }
    });
  </script>
</body>
</html>
